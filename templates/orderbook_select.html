<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Orderbook Snapshot Viewer</title>
  <!-- Link to CSS file -->
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    /* If needed, minimal inline styles or overrides can go here */
  </style>
</head>
<body>
  <h1>ğŸ“ˆ í˜¸ê°€ ë°ì´í„° ì¡°íšŒ</h1>

    <!-- Selection Form -->
    <form method="get" action="/orderbook" id="snapshotForm">

        <!-- ê±°ë˜ì†Œ ì„ íƒ -->
        <label for="exchange">ê±°ë˜ì†Œ:</label>
        <select name="exchange" id="exchange" required onchange="this.form.submit()">
        <option value="" disabled {{ not selected.exchange and 'selected' }}>Select Exchange</option>
        {% for ex, symbols in tickers.items() %}
          <option value="{{ ex }}" {% if selected.exchange == ex %}selected{% endif %}>{{ ex }}</option>
        {% endfor %}
        </select>

        <!-- í‹°ì»¤ ì„ íƒ -->
        <label for="ticker">í‹°ì»¤:</label>
        <select name="ticker" id="ticker" required>
        {% if selected.exchange %}
          {% for sym in tickers[selected.exchange] %}
            <option value="{{ sym }}" {% if selected.ticker == sym %}selected{% endif %}>{{ sym }}</option>
          {% endfor %}
        {% else %}
          <option value="" disabled selected>-- ê±°ë˜ì†Œë¥¼ ë¨¼ì € ì„ íƒ --</option>
        {% endif %}
        </select>

        <!-- ë‚ ì§œ ì…ë ¥ -->
        <label for="date">ë‚ ì§œ:</label>
        <input type="text" name="date" id="date" value="{{ selected.date or date }}" required>

        <!-- ì‹œê°„ ì„ íƒ -->
        <label for="hour">ì‹œê°„:</label>
        <select name="hour" id="hour" required onchange="this.form.submit()">
          {% for hour_str in available_hours %}
            <option value="{{ hour_str }}" {% if selected.hour == hour_str %}selected{% endif %}>
              {{ hour_str }}ì‹œ
            </option>
          {% endfor %}
        </select>
        
        <!-- ìŠ¤ëƒ…ìƒ· ì„ íƒ -->
        {% if snapshots %}
          <label for="snapshot">ìŠ¤ëƒ…ìƒ· ì‹œì :</label>
          <select name="snapshot_index" required>
            {% for snap in snapshots %}
                <option value="{{ loop.index0 }}" 
                        {% if loop.index0 == selected.snapshot_index %}selected{% endif %}>
                    {{ snap.time }}
                </option>
            {% endfor %}
          </select>
        
        <script>
            document.getElementById('snapshot').addEventListener('change', function () {
                document.getElementById('snapshotForm').submit();
            });
        </script>
        
        {% else %}
          <span style="color: red;">ğŸ“› ì„ íƒ ê°€ëŠ¥í•œ ìŠ¤ëƒ…ìƒ·ì´ ì—†ìŠµë‹ˆë‹¤.</span>
        {% endif %}
        <button type="submit">ë¶ˆëŸ¬ì˜¤ê¸°</button>

    </form>


  {% if snapshots and selected_snapshot %}
  <!-- Snapshot Selection and Orderbook Display -->
  <hr>
  
    {% if selected_snapshot %}
        <h3>{{ selected.exchange }} {{ selected.ticker }} - {{ selected_snapshot.time }}</h3>
    {% else %}
        <h3>{{ exchange }} {{ ticker }} - {{ date }} {{ hour }}ì‹œ</h3>
    {% endif %}
  
  <!-- Orderbook table for the selected snapshot -->
  <div class="timestamp">ì‹œì : {{ selected_snapshot.time }}</div>
  <table class="orderbook-table">
    <thead>
      <tr>
        <th class="buy-header">Bid Price</th>
        <th class="buy-header">Bid Qty</th>
        <th class="sell-header">Ask Price</th>
        <th class="sell-header">Ask Qty</th>
      </tr>
    </thead>
    <tbody>
      {% for row in selected_snapshot.rows %}
        <tr>
          <td class="buy-price">
            {% if row.bid_price %}
              {{ "{:,.0f}".format(row.bid_price|float) }}
            {% else %} - {% endif %}
          </td>
          <td>
            {% if row.bid_qty %}
              {{ "{:.8f}".format(row.bid_qty|float) }}
            {% else %} - {% endif %}
          </td>            
          <td class="sell-price">
            {% if row.ask_price %}
              {{ "{:,.0f}".format(row.ask_price|float) }}
            {% else %} - {% endif %}
          </td>
          <td>
            {% if row.ask_qty %}
              {{ "{:.8f}".format(row.ask_qty|float) }}
            {% else %} - {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
  
  {% if error %}
  <p style="color:red;">âš  {{ error }}</p>
  {% endif %}
</body>
</html>
