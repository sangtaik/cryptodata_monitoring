<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Orderbook Collector Management</title>
  <style>
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 8px; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>Orderbook Collector Management</h1>

  <!-- Ticker Management Section -->
  <h2>Ticker Management</h2>
  <!-- Search form -->
  <form method="get" action="/" style="margin-bottom: 1em;">
    <input type="text" name="q" placeholder="Search ticker..." value="{{ query or '' }}" />
    <button type="submit">Search</button>
  </form>
  <!-- Tickers table -->
  <table>
    <tr>
      <th>Exchange</th>
      <th>Ticker</th>
      <th>Action</th>
    </tr>
    {% for item in tickers %}
      <tr>
        <td>{{ item.exchange }}</td>
        <td>{{ item.ticker }}</td>
        <td>
          <!-- Delete form for each ticker -->
          <form method="post" action="/delete" style="display:inline;">
            <input type="hidden" name="exchange" value="{{ item.exchange }}" />
            <input type="hidden" name="ticker" value="{{ item.ticker }}" />
            <button type="submit">Delete</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr>
        <td colspan="3">No tickers being tracked.</td>
      </tr>
    {% endfor %}
  </table>

  <!-- Add new ticker form -->
  <h3>Add New Ticker</h3>
  <form method="post" action="/add" style="margin-top: 0.5em;">
    <label for="exchange">Exchange:</label>
    <select name="exchange" id="exchange" required>
      <option value="" disabled selected>Select Exchange</option>
      <option value="Upbit">Upbit</option>
      <option value="Bithumb">Bithumb</option>
      <option value="Coinone">Coinone</option>
      <option value="Korbit">Korbit</option>
      <option value="Gopax">Gopax</option>
    </select>
    <label for="ticker">Ticker:</label>
    <input type="text" name="ticker" id="ticker" placeholder="e.g. ETH/KRW" required />
    <button type="submit">Add</button>
  </form>

  <!-- Status Monitoring Section -->
  <h2>Collection Status</h2>
  <table>
    <tr>
      <th>Exchange</th>
      <th>Status</th>
      <th>Last Updated</th>
    </tr>
    {% if status_info %}
      {% for ex, info in status_info.items() %}
        <tr>
          <td>{{ ex }}</td>
          <td>{{ info.status }}</td>
          <td>{{ info.last_updated }}</td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="3">No exchanges currently tracked.</td>
      </tr>
    {% endif %}
  </table>
</body>
</html>
